{"version":3,"file":"bigcommerce.js","names":["BigCommerce","config","errMessage","Error","grantType","createAPIRequest","endpoint","accept","responseType","Request","headers","Object","assign","clientId","accessToken","logger","agent","verify","signedRequest","error","splitRequest","split","length","signature","Buffer","from","toString","json","data","handleConversionStringToObject","expected","crypto","createHmac","secret","update","digest","info","timingSafeEqual","authorize","query","code","scope","context","queryCode","queryScope","queryContext","payload","client_id","client_secret","grant_type","request","REQUEST_BIGCOMMERCE_LOGIN_URL","oauthToken","run","type","path","storeHash","extension","REQUEST_BIGCOMMERCE_API_URL","version","includes","replace","fullPath","response","meta","pagination","totalPages","total_pages","currentPage","current_page","promises","nextPage","endpointUrl","URL","hostname","searchParams","set","push","pathname","search","Promise","all","responses","forEach","pageResponse","concat","get","post","put","delete"],"sources":["../src/utils/bigcommerce.js"],"sourcesContent":["/* eslint-disable no-undef */\n\"use strict\";\n\nimport crypto from \"crypto\";\nimport { REQUEST_BIGCOMMERCE_API_URL, REQUEST_BIGCOMMERCE_LOGIN_URL } from \"../constants\";\nimport { handleConversionStringToObject } from \"./convertValues\";\nimport Request from \"./request\";\n\nclass BigCommerce {\n\tconstructor(config) {\n\t\tif (!config) {\n\t\t\tconst errMessage = new Error(\"Config missing. The config object is required to make any call to the BigCommerce API\");\n\n\t\t\tthrow errMessage;\n\t\t}\n\n\t\tthis.config = config;\n\t\tthis.grantType = \"authorization_code\";\n\t}\n\n\t// Handle creating API request\n\tcreateAPIRequest(endpoint) {\n\t\tconst accept = this.config.responseType === \"xml\" ? \"application/xml\" : \"application/json\";\n\n\t\treturn new Request(endpoint, {\n\t\t\theaders: Object.assign(\n\t\t\t\t{\n\t\t\t\t\t\"Accept\": accept,\n\t\t\t\t\t\"X-Auth-Client\": this.config.clientId,\n\t\t\t\t\t\"X-Auth-Token\": this.config.accessToken\n\t\t\t\t},\n\t\t\t\tthis.config.headers\n\t\t\t),\n\t\t\tlogger: this.config.logger,\n\t\t\tagent: this.config.agent\n\t\t});\n\t}\n\n\t// Handle verfiy signed request\n\tasync verify(signedRequest) {\n\t\t// If `signedRequest` is \"undefined\", throw an error\n\t\t!signedRequest ? this.config.logger.error(\"The signed request is required to verify the call.\") : null;\n\n\t\tconst splitRequest = signedRequest.split(\".\");\n\n\t\t// If `splitRequest` length is less than 2, throw an error\n\t\tsplitRequest.length < 2 ? this.config.logger.error(\"The signed request will come in two parts seperated by a .(full stop). \" + \"this signed request contains less than 2 parts.\") : null;\n\n\t\t// Check and verify validity of signatures\n\t\tconst signature = Buffer.from(splitRequest[1], \"base64\").toString(\"utf8\");\n\t\tconst json = Buffer.from(splitRequest[0], \"base64\").toString(\"utf8\");\n\t\tconst data = handleConversionStringToObject(json);\n\t\tconst expected = crypto.createHmac(\"sha256\", this.config.secret).update(json).digest(\"hex\");\n\n\t\tthis.config.logger.info(\"JSON: \" + json);\n\t\tthis.config.logger.info(\"SIGNATURE: \" + signature);\n\t\tthis.config.logger.info(\"EXPECTED SIGNATURE: \" + expected);\n\n\t\t// If the expected length of signature doesn't match the current signature length, throw an error, otherwise return data\n\t\texpected.length !== signature.length || crypto.timingSafeEqual(Buffer.from(expected, \"utf8\"), Buffer.from(signature, \"utf8\")) ? this.config.logger.error(\"The signature is invalid.\") : null;\n\n\t\t// Send log message when signature is valid\n\t\tthis.config.logger.info(\"The signature is valid.\");\n\n\t\treturn data;\n\t}\n\n\t// Handle authentication request\n\tasync authorize(query) {\n\t\t// if `query` is undefined, throw an error\n\t\t!query ? this.config.logger.error(\"The URL query paramaters are required.\") : null;\n\n\t\t// Query props\n\t\tconst { code, scope, context } = await query;\n\t\tconst queryCode = code ?? null;\n\t\tconst queryScope = scope ?? null;\n\t\tconst queryContext = context ?? null;\n\n\t\t// Init payload\n\t\tconst payload = {\n\t\t\tclient_id: this.config.clientId,\n\t\t\tclient_secret: this.config.secret,\n\t\t\tgrant_type: this.grantType,\n\t\t\tcode: queryCode,\n\t\t\tscope: queryScope,\n\t\t\tcontext: queryContext\n\t\t};\n\n\t\t// Run request\n\t\tconst request = this.createAPIRequest(REQUEST_BIGCOMMERCE_LOGIN_URL);\n\t\tconst oauthToken = \"/oauth2/token\";\n\n\t\treturn await request.run(\"post\", oauthToken, payload);\n\t}\n\n\t// Handle API requests\n\tasync request(type, path, data = null) {\n\t\t// If current `config` have undefined `accessToken`, throw an error\n\t\tthis.config.accessToken == null ? this.config.logger.error(\"The access token is required to make BigCommerce API requests.\") : null;\n\n\t\t// If current `config` have undefined `storeHash`, throw an error\n\t\tthis.config.storeHash == null ? this.config.logger.error(\"The store hash is required to make BigCommerce API requests.\") : null;\n\n\t\t// Prepare `path` for request execution\n\t\tconst extension = this.config.responseType === \"xml\" ? \".xml\" : \"\";\n\t\tconst request = this.createAPIRequest(REQUEST_BIGCOMMERCE_API_URL);\n\t\tconst version = !path.includes(\"v3\") ? path.replace(/(\\?|$)/, extension + \"$1\") : path;\n\n\t\t// Update full path\n\t\tlet fullPath = `/stores/${this.config.storeHash}`;\n\n\t\tfullPath += version;\n\n\t\tconst response = await request.run(type, fullPath, data);\n\n\t\t// If response contains pagination.\n\t\tif (\"meta\" in response && \"pagination\" in response.meta) {\n\t\t\tconst { total_pages: totalPages, current_page: currentPage } = response.meta.pagination;\n\n\t\t\t// If current page is not the last page.\n\t\t\tif (totalPages > currentPage) {\n\t\t\t\t// Collect all page request promises in array.\n\t\t\t\tconst promises = [];\n\n\t\t\t\tfor (let nextPage = currentPage + 1; nextPage <= totalPages; nextPage++) {\n\t\t\t\t\tconst endpointUrl = new URL(fullPath, `https://${request.hostname}`);\n\n\t\t\t\t\t// Safely assign `page` query parameter to endpoint URL.\n\t\t\t\t\tendpointUrl.searchParams.set(\"page\", nextPage);\n\n\t\t\t\t\t// Add promise to array for future Promise.All() call.\n\t\t\t\t\tpromises.push(request.run(type, `${endpointUrl.pathname}${endpointUrl.search}`, data));\n\t\t\t\t}\n\n\t\t\t\t// Request all endpoints in parallel.\n\t\t\t\tconst responses = await Promise.all(promises);\n\n\t\t\t\tresponses.forEach((pageResponse) => {\n\t\t\t\t\tresponse.data = response.data.concat(pageResponse.data);\n\t\t\t\t});\n\n\t\t\t\t// Set pager to last page.\n\t\t\t\tresponse.meta.pagination.total_pages = totalPages;\n\t\t\t\tresponse.meta.pagination.current_page = totalPages;\n\t\t\t}\n\t\t}\n\n\t\t// Run request\n\t\treturn response;\n\t}\n\n\t// Handle `GET` request\n\tasync get(path) {\n\t\treturn await this.request(\"get\", path);\n\t}\n\n\t// Handle `POST` request\n\tasync post(path, data) {\n\t\treturn await this.request(\"post\", path, data);\n\t}\n\n\t// Handle `PUT` request\n\tasync put(path, data) {\n\t\treturn await this.request(\"put\", path, data);\n\t}\n\n\t// Handle `DELETE` request\n\tasync delete(path) {\n\t\treturn await this.request(\"delete\", path);\n\t}\n}\n\nexport default BigCommerce;\n"],"mappings":"AACA;;;;;;;;;;;AAEA;;AACA;;AACA;;AACA;;IAEMA,W;EACL,qBAAYC,MAAZ,EAAoB;IACnB,IAAI,CAACA,MAAL,EAAa;MACZ,IAAMC,UAAU,GAAG,IAAIC,KAAJ,CAAU,uFAAV,CAAnB;MAEA,MAAMD,UAAN;IACA;;IAED,KAAKD,MAAL,GAAcA,MAAd;IACA,KAAKG,SAAL,GAAiB,oBAAjB;EACA;;;;SAGDC,gB,GAAA,0BAAiBC,QAAjB,EAA2B;IAC1B,IAAMC,MAAM,GAAG,KAAKN,MAAL,CAAYO,YAAZ,KAA6B,KAA7B,GAAqC,iBAArC,GAAyD,kBAAxE;IAEA,OAAO,IAAIC,iBAAJ,CAAYH,QAAZ,EAAsB;MAC5BI,OAAO,EAAEC,MAAM,CAACC,MAAP,CACR;QACC,UAAUL,MADX;QAEC,iBAAiB,KAAKN,MAAL,CAAYY,QAF9B;QAGC,gBAAgB,KAAKZ,MAAL,CAAYa;MAH7B,CADQ,EAMR,KAAKb,MAAL,CAAYS,OANJ,CADmB;MAS5BK,MAAM,EAAE,KAAKd,MAAL,CAAYc,MATQ;MAU5BC,KAAK,EAAE,KAAKf,MAAL,CAAYe;IAVS,CAAtB,CAAP;EAYA,C;;SAGKC,M;4EAAN,iBAAaC,aAAb;MAAA;MAAA;QAAA;UAAA;YAAA;cAEC,CAACA,aAAD,GAAiB,KAAKjB,MAAL,CAAYc,MAAZ,CAAmBI,KAAnB,CAAyB,oDAAzB,CAAjB,GAAkG,IAAlG;cAEMC,YAJP,GAIsBF,aAAa,CAACG,KAAd,CAAoB,GAApB,CAJtB;cAOCD,YAAY,CAACE,MAAb,GAAsB,CAAtB,GAA0B,KAAKrB,MAAL,CAAYc,MAAZ,CAAmBI,KAAnB,CAAyB,4EAA4E,iDAArG,CAA1B,GAAoL,IAApL;cAGMI,SAVP,GAUmBC,MAAM,CAACC,IAAP,CAAYL,YAAY,CAAC,CAAD,CAAxB,EAA6B,QAA7B,EAAuCM,QAAvC,CAAgD,MAAhD,CAVnB;cAWOC,IAXP,GAWcH,MAAM,CAACC,IAAP,CAAYL,YAAY,CAAC,CAAD,CAAxB,EAA6B,QAA7B,EAAuCM,QAAvC,CAAgD,MAAhD,CAXd;cAYOE,IAZP,GAYc,IAAAC,6CAAA,EAA+BF,IAA/B,CAZd;cAaOG,QAbP,GAakBC,eAAA,CAAOC,UAAP,CAAkB,QAAlB,EAA4B,KAAK/B,MAAL,CAAYgC,MAAxC,EAAgDC,MAAhD,CAAuDP,IAAvD,EAA6DQ,MAA7D,CAAoE,KAApE,CAblB;cAeC,KAAKlC,MAAL,CAAYc,MAAZ,CAAmBqB,IAAnB,CAAwB,WAAWT,IAAnC;cACA,KAAK1B,MAAL,CAAYc,MAAZ,CAAmBqB,IAAnB,CAAwB,gBAAgBb,SAAxC;cACA,KAAKtB,MAAL,CAAYc,MAAZ,CAAmBqB,IAAnB,CAAwB,yBAAyBN,QAAjD;cAGAA,QAAQ,CAACR,MAAT,KAAoBC,SAAS,CAACD,MAA9B,IAAwCS,eAAA,CAAOM,eAAP,CAAuBb,MAAM,CAACC,IAAP,CAAYK,QAAZ,EAAsB,MAAtB,CAAvB,EAAsDN,MAAM,CAACC,IAAP,CAAYF,SAAZ,EAAuB,MAAvB,CAAtD,CAAxC,GAAgI,KAAKtB,MAAL,CAAYc,MAAZ,CAAmBI,KAAnB,CAAyB,2BAAzB,CAAhI,GAAwL,IAAxL;cAGA,KAAKlB,MAAL,CAAYc,MAAZ,CAAmBqB,IAAnB,CAAwB,yBAAxB;cAvBD,iCAyBQR,IAzBR;;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA,C;;;;;;;;;SA6BMU,S;+EAAN,kBAAgBC,KAAhB;MAAA;;MAAA;QAAA;UAAA;YAAA;cAEC,CAACA,KAAD,GAAS,KAAKtC,MAAL,CAAYc,MAAZ,CAAmBI,KAAnB,CAAyB,wCAAzB,CAAT,GAA8E,IAA9E;cAFD;cAAA,OAKwCoB,KALxC;;YAAA;cAAA;cAKSC,IALT,gBAKSA,IALT;cAKeC,KALf,gBAKeA,KALf;cAKsBC,OALtB,gBAKsBA,OALtB;cAMOC,SANP,GAMmBH,IANnB,aAMmBA,IANnB,cAMmBA,IANnB,GAM2B,IAN3B;cAOOI,UAPP,GAOoBH,KAPpB,aAOoBA,KAPpB,cAOoBA,KAPpB,GAO6B,IAP7B;cAQOI,YARP,GAQsBH,OARtB,aAQsBA,OARtB,cAQsBA,OARtB,GAQiC,IARjC;cAWOI,OAXP,GAWiB;gBACfC,SAAS,EAAE,KAAK9C,MAAL,CAAYY,QADR;gBAEfmC,aAAa,EAAE,KAAK/C,MAAL,CAAYgC,MAFZ;gBAGfgB,UAAU,EAAE,KAAK7C,SAHF;gBAIfoC,IAAI,EAAEG,SAJS;gBAKfF,KAAK,EAAEG,UALQ;gBAMfF,OAAO,EAAEG;cANM,CAXjB;cAqBOK,OArBP,GAqBiB,KAAK7C,gBAAL,CAAsB8C,wCAAtB,CArBjB;cAsBOC,UAtBP,GAsBoB,eAtBpB;cAAA;cAAA,OAwBcF,OAAO,CAACG,GAAR,CAAY,MAAZ,EAAoBD,UAApB,EAAgCN,OAAhC,CAxBd;;YAAA;cAAA;;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA,C;;;;;;;;;SA4BMI,O;6EAAN,kBAAcI,IAAd,EAAoBC,IAApB,EAA0B3B,IAA1B;MAAA;;MAAA;QAAA;UAAA;YAAA;cAAA,IAA0BA,IAA1B;gBAA0BA,IAA1B,GAAiC,IAAjC;cAAA;;cAEC,KAAK3B,MAAL,CAAYa,WAAZ,IAA2B,IAA3B,GAAkC,KAAKb,MAAL,CAAYc,MAAZ,CAAmBI,KAAnB,CAAyB,gEAAzB,CAAlC,GAA+H,IAA/H;cAGA,KAAKlB,MAAL,CAAYuD,SAAZ,IAAyB,IAAzB,GAAgC,KAAKvD,MAAL,CAAYc,MAAZ,CAAmBI,KAAnB,CAAyB,8DAAzB,CAAhC,GAA2H,IAA3H;cAGMsC,SARP,GAQmB,KAAKxD,MAAL,CAAYO,YAAZ,KAA6B,KAA7B,GAAqC,MAArC,GAA8C,EARjE;cASO0C,OATP,GASiB,KAAK7C,gBAAL,CAAsBqD,sCAAtB,CATjB;cAUOC,OAVP,GAUiB,CAACJ,IAAI,CAACK,QAAL,CAAc,IAAd,CAAD,GAAuBL,IAAI,CAACM,OAAL,CAAa,QAAb,EAAuBJ,SAAS,GAAG,IAAnC,CAAvB,GAAkEF,IAVnF;cAaKO,QAbL,gBAa2B,KAAK7D,MAAL,CAAYuD,SAbvC;cAeCM,QAAQ,IAAIH,OAAZ;cAfD;cAAA,OAiBwBT,OAAO,CAACG,GAAR,CAAYC,IAAZ,EAAkBQ,QAAlB,EAA4BlC,IAA5B,CAjBxB;;YAAA;cAiBOmC,QAjBP;;cAAA,MAoBK,UAAUA,QAAV,IAAsB,gBAAgBA,QAAQ,CAACC,IApBpD;gBAAA;gBAAA;cAAA;;cAAA,wBAqBiED,QAAQ,CAACC,IAAT,CAAcC,UArB/E,EAqBuBC,UArBvB,yBAqBUC,WArBV,EAqBiDC,WArBjD,yBAqBmCC,YArBnC;;cAAA,MAwBMH,UAAU,GAAGE,WAxBnB;gBAAA;gBAAA;cAAA;;cA0BSE,QA1BT,GA0BoB,EA1BpB;;cA4BG,KAASC,QAAT,GAAoBH,WAAW,GAAG,CAAlC,EAAqCG,QAAQ,IAAIL,UAAjD,EAA6DK,QAAQ,EAArE,EAAyE;gBAClEC,WADkE,GACpD,IAAIC,GAAJ,CAAQX,QAAR,eAA6BZ,OAAO,CAACwB,QAArC,CADoD;gBAIxEF,WAAW,CAACG,YAAZ,CAAyBC,GAAzB,CAA6B,MAA7B,EAAqCL,QAArC;gBAGAD,QAAQ,CAACO,IAAT,CAAc3B,OAAO,CAACG,GAAR,CAAYC,IAAZ,OAAqBkB,WAAW,CAACM,QAAjC,GAA4CN,WAAW,CAACO,MAAxD,EAAkEnD,IAAlE,CAAd;cACA;;cApCJ;cAAA,OAuC2BoD,OAAO,CAACC,GAAR,CAAYX,QAAZ,CAvC3B;;YAAA;cAuCSY,SAvCT;cAyCGA,SAAS,CAACC,OAAV,CAAkB,UAACC,YAAD,EAAkB;gBACnCrB,QAAQ,CAACnC,IAAT,GAAgBmC,QAAQ,CAACnC,IAAT,CAAcyD,MAAd,CAAqBD,YAAY,CAACxD,IAAlC,CAAhB;cACA,CAFD;cAKAmC,QAAQ,CAACC,IAAT,CAAcC,UAAd,CAAyBE,WAAzB,GAAuCD,UAAvC;cACAH,QAAQ,CAACC,IAAT,CAAcC,UAAd,CAAyBI,YAAzB,GAAwCH,UAAxC;;YA/CH;cAAA,kCAoDQH,QApDR;;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA,C;;;;;;;;;SAwDMuB,G;yEAAN,kBAAU/B,IAAV;MAAA;QAAA;UAAA;YAAA;cAAA;cAAA,OACc,KAAKL,OAAL,CAAa,KAAb,EAAoBK,IAApB,CADd;;YAAA;cAAA;;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA,C;;;;;;;;;SAKMgC,I;0EAAN,kBAAWhC,IAAX,EAAiB3B,IAAjB;MAAA;QAAA;UAAA;YAAA;cAAA;cAAA,OACc,KAAKsB,OAAL,CAAa,MAAb,EAAqBK,IAArB,EAA2B3B,IAA3B,CADd;;YAAA;cAAA;;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA,C;;;;;;;;;SAKM4D,G;yEAAN,kBAAUjC,IAAV,EAAgB3B,IAAhB;MAAA;QAAA;UAAA;YAAA;cAAA;cAAA,OACc,KAAKsB,OAAL,CAAa,KAAb,EAAoBK,IAApB,EAA0B3B,IAA1B,CADd;;YAAA;cAAA;;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA,C;;;;;;;;;SAKM6D,M;6EAAN,kBAAalC,IAAb;MAAA;QAAA;UAAA;YAAA;cAAA;cAAA,OACc,KAAKL,OAAL,CAAa,QAAb,EAAuBK,IAAvB,CADd;;YAAA;cAAA;;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA,C;;;;;;;;;;;;eAKcvD,W"}