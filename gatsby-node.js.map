{"version":3,"file":"gatsby-node.js","names":["handleCreateNodeFromData","item","nodeType","helpers","nodeMetadata","id","createNodeId","bigcommerce_id","parent","children","internal","type","content","handleConversionObjectToString","contentDigest","createContentDigest","node","Object","assign","createNode","exports","onPreInit","logLevels","levels","info","colors","addColors","combine","timestamp","colorize","simple","format","logger","createLogger","level","transports","Console","onCreateWebpackConfig","actions","setWebpackConfig","resolve","fallback","crypto","https","zlib","sourceNodes","pluginOptions","endpoints","clientId","secret","storeHash","accessToken","siteUrl","preview","logLevel","agent","responseType","headers","sanitizedSiteUrl","handleConversionStringToLowercase","sanitizedLogLevel","sanitizeResponseType","error","debug","errMessage","BC","BigCommerce","keys","length","Promise","all","entries","map","nodeName","endpoint","get","then","res","resData","Array","isArray","data","datum","catch","err","Error","finally","IS_DEV","body","scope","is_active","destination","BIGCOMMERCE_WEBHOOK_API_ENDPOINT","post","server","micro","req","request","json","productId","newProduct","nodeToUpdate","end","listen","exitMessage","onCreateDevServer","app","use","createProxyMiddleware","target","secure"],"sources":["src/gatsby-node.js"],"sourcesContent":["\"use strict\";\n\nimport { createProxyMiddleware } from \"http-proxy-middleware\";\nimport micro from \"micro\";\nimport { addColors, createLogger, format, transports } from \"winston\";\nimport { BIGCOMMERCE_WEBHOOK_API_ENDPOINT, IS_DEV } from \"./constants\";\nimport BigCommerce from \"./utils/bigcommerce\";\nimport { handleConversionObjectToString, handleConversionStringToLowercase } from \"./utils/convertValues\";\n\n/**\n * ============================================================================\n * Helper functions and constants\n * ============================================================================\n */\nconst handleCreateNodeFromData = (item, nodeType, helpers) => {\n\tconst nodeMetadata = {\n\t\t...item,\n\t\tid: helpers.createNodeId(`${nodeType}-${item.id}`),\n\t\tbigcommerce_id: item.id,\n\t\tparent: null,\n\t\tchildren: [],\n\t\tinternal: {\n\t\t\ttype: nodeType,\n\t\t\tcontent: handleConversionObjectToString(item),\n\t\t\tcontentDigest: helpers.createContentDigest(item)\n\t\t}\n\t};\n\n\tconst node = Object.assign({}, item, nodeMetadata);\n\n\thelpers.createNode(node);\n\n\treturn node;\n};\n\n/**\n * ============================================================================\n * Verify plugin loads and check for required plugin options\n * ============================================================================\n */\nexports.onPreInit = () => {\n\t// Add custom log levels\n\tconst logLevels = {\n\t\tlevels: {\n\t\t\tinfo: 1\n\t\t},\n\t\tcolors: {\n\t\t\tinfo: \"bold green\"\n\t\t}\n\t};\n\n\t// Add console colors\n\taddColors(logLevels.colors);\n\n\tconst { combine, timestamp, colorize, simple } = format;\n\n\t// Init `winston` logger\n\tconst logger = createLogger({\n\t\tlevel: \"info\",\n\t\tlevels: logLevels.levels,\n\t\tformat: combine(colorize(), simple(), timestamp()),\n\t\ttransports: [new transports.Console()]\n\t});\n\n\tlogger.info(\"`gatsby-source-bigcommerce` plugin loaded successfully.\");\n};\n\n/**\n * ============================================================================\n * Override Gatsby default Webpack configuration\n * ============================================================================\n */\nexports.onCreateWebpackConfig = async ({ actions }) => {\n\tactions.setWebpackConfig({\n\t\tresolve: {\n\t\t\tfallback: { crypto: false, https: false, zlib: false }\n\t\t}\n\t});\n};\n\n/**\n * ============================================================================\n * Source and cache nodes from the BigCommerce API\n * ============================================================================\n */\nexports.sourceNodes = async ({ actions, createNodeId, createContentDigest }, pluginOptions) => {\n\tconst { createNode } = actions;\n\tconst { endpoints = null, clientId = null, secret = null, storeHash = null, accessToken = null, siteUrl = null, preview = false, logLevel = \"info\", agent = null, responseType = \"json\", headers = {} } = pluginOptions;\n\n\tconst helpers = Object.assign({}, actions, {\n\t\tcreateContentDigest,\n\t\tcreateNodeId\n\t});\n\n\tconst sanitizedSiteUrl = handleConversionStringToLowercase(siteUrl);\n\tconst sanitizedLogLevel = handleConversionStringToLowercase(logLevel);\n\tconst sanitizeResponseType = handleConversionStringToLowercase(responseType);\n\n\t// Add custom log levels\n\tconst logLevels = {\n\t\tlevels: {\n\t\t\terror: 0,\n\t\t\tdebug: 1,\n\t\t\tinfo: 2\n\t\t},\n\t\tcolors: {\n\t\t\terror: \"bold red\",\n\t\t\tdebug: \"bold blue\",\n\t\t\tinfo: \"bold green\"\n\t\t}\n\t};\n\n\t// Add console colors\n\taddColors(logLevels.colors);\n\n\tconst { combine, timestamp, colorize, simple } = format;\n\n\t// Init `winston` logger\n\tconst logger = createLogger({\n\t\tlevel: sanitizedLogLevel,\n\t\tlevels: logLevels.levels,\n\t\tformat: combine(colorize(), simple(), timestamp()),\n\t\ttransports: [new transports.Console()]\n\t});\n\n\t// Custom variables\n\tlet errMessage = \"\";\n\n\tlogger.info(\"Checking BigCommerce plugin options...\");\n\n\tif (endpoints !== null && clientId !== null && secret !== null && storeHash !== null && accessToken !== null) {\n\t\t// Init new `BigCommerce` instance\n\t\tconst BC = new BigCommerce({\n\t\t\tclientId: clientId,\n\t\t\taccessToken: accessToken,\n\t\t\tsecret: secret,\n\t\t\tstoreHash: storeHash,\n\t\t\tresponseType: sanitizeResponseType,\n\t\t\tlogger: logger,\n\t\t\tagent: agent,\n\t\t\theaders: headers\n\t\t});\n\n\t\t// Handle fetching and creating nodes for a single or multiple endpoints\n\t\tif (endpoints && typeof endpoints === \"object\" && Object.keys(endpoints).length > 0) {\n\t\t\t// Send log message when fetching data\n\t\t\tlogger.info(\"Valid plugin options found. Proceeding with plugin initialization...\");\n\t\t\tlogger.info(\"Requesting endpoint data...\");\n\n\t\t\tawait Promise.all(\n\t\t\t\tObject.entries(endpoints).map(([nodeName, endpoint]) => {\n\t\t\t\t\treturn BC.get(endpoint).then((res) => {\n\t\t\t\t\t\t// If the data object is not on the response, it could be `v2` which returns an array as the root, so use that as a fallback\n\t\t\t\t\t\tconst resData = \"data\" in res && Array.isArray(res.data) ? res.data : res;\n\n\t\t\t\t\t\t// Handle generating nodes\n\t\t\t\t\t\treturn \"data\" in res && Array.isArray(res.data)\n\t\t\t\t\t\t\t? resData.map((datum) => handleCreateNodeFromData(datum, nodeName, helpers))\n\t\t\t\t\t\t\t: Array.isArray(res)\n\t\t\t\t\t\t\t? res.map((datum) => handleCreateNodeFromData(datum, nodeName, helpers))\n\t\t\t\t\t\t\t: handleCreateNodeFromData(resData, nodeName, helpers);\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t)\n\t\t\t\t.then(() => {\n\t\t\t\t\t// Send log message when all endpoints have been fetched\n\t\t\t\t\tlogger.info(\"All endpoint data have been fetched successfully.\");\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\t// Send log message when an error occurs\n\t\t\t\t\terrMessage = new Error(`An error occurred while fetching endpoint data. ${err}`);\n\t\t\t\t})\n\t\t\t\t.finally(() =>\n\t\t\t\t\t// Send log message when fetching data is complete\n\t\t\t\t\tlogger.info(\"Requesting endpoint data complete.\")\n\t\t\t\t);\n\t\t} else {\n\t\t\terrMessage = new Error(\"The `endpoints` object is required to make any call to the BigCommerce API\");\n\t\t}\n\n\t\tif (IS_DEV && preview && sanitizedSiteUrl !== null) {\n\t\t\tlogger.info(\"Preview mode enabled. Subscribing you to BigCommerce API webhook...\");\n\n\t\t\t// Make a `POST` request to the BigCommerce API to subscribe to its webhook\n\t\t\tconst body = {\n\t\t\t\tscope: \"store/product/updated\",\n\t\t\t\tis_active: true,\n\t\t\t\tdestination: `${sanitizedSiteUrl}/__BCPreview`\n\t\t\t};\n\n\t\t\tawait BC.get(BIGCOMMERCE_WEBHOOK_API_ENDPOINT)\n\t\t\t\t.then((res) => {\n\t\t\t\t\tif (\"data\" in res && Object.keys(res.data).length > 0) {\n\t\t\t\t\t\tlogger.info(\"BigCommerce API webhook subscription already exists. Skipping subscription...\");\n\t\t\t\t\t\tlogger.info(\"BigCommerce API webhook subscription complete. Running preview server...\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\t(async () =>\n\t\t\t\t\t\t\tawait BC.post(BIGCOMMERCE_WEBHOOK_API_ENDPOINT, body).then((res) => {\n\t\t\t\t\t\t\t\tif (\"data\" in res && Object.keys(res.data).length > 0) {\n\t\t\t\t\t\t\t\t\tlogger.info(\"BigCommerce API webhook subscription created successfully. Running preview server...\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}))();\n\t\t\t\t\t}\n\n\t\t\t\t\tconst server = micro(async (req, res) => {\n\t\t\t\t\t\tconst request = await micro.json(req);\n\t\t\t\t\t\tconst productId = request.data.id;\n\n\t\t\t\t\t\t// Webhooks don't send any data, so we need to make a request to the BigCommerce API to get the product data\n\t\t\t\t\t\tconst newProduct = await BC.get(`/catalog/products/${productId}`);\n\t\t\t\t\t\tconst nodeToUpdate = newProduct.data;\n\n\t\t\t\t\t\tif (nodeToUpdate.id) {\n\t\t\t\t\t\t\tcreateNode({\n\t\t\t\t\t\t\t\t...nodeToUpdate,\n\t\t\t\t\t\t\t\tid: createNodeId(`${nodeToUpdate?.id ?? `BigCommerceNode`}`),\n\t\t\t\t\t\t\t\tparent: null,\n\t\t\t\t\t\t\t\tchildren: [],\n\t\t\t\t\t\t\t\tinternal: {\n\t\t\t\t\t\t\t\t\ttype: `BigCommerceNode`,\n\t\t\t\t\t\t\t\t\tcontentDigest: createContentDigest(nodeToUpdate)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tlogger.info(`Updated node: ${nodeToUpdate.id}`);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Send a response back to the BigCommerce API\n\t\t\t\t\t\tres.end(\"ok\");\n\t\t\t\t\t});\n\n\t\t\t\t\tserver.listen(8033, logger.info(`Now listening to changes for live preview at /__BCPreview`));\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\terrMessage = new Error(`An error occurred while creating BigCommerce API webhook subscription. ${err}`);\n\t\t\t\t});\n\t\t}\n\t} else {\n\t\t// If `endpoints` is null, throw an error\n\t\tif (endpoints == null) {\n\t\t\terrMessage = new Error(\"The `endpoints` are required to make any call to the BigCommerce API\");\n\t\t}\n\n\t\t// If `clientId` is null, throw an error\n\t\tif (clientId == null) {\n\t\t\terrMessage = new Error(\"The `clientId` is required to make any call to the BigCommerce API\");\n\t\t}\n\n\t\t// If `secret` is null, throw an error\n\t\tif (secret == null) {\n\t\t\terrMessage = new Error(\"The `secret` is required to make any call to the BigCommerce API\");\n\t\t}\n\n\t\t// If `storeHash` is null, throw an error\n\t\tif (storeHash == null) {\n\t\t\terrMessage = new Error(\"The `storeHash` is required to make any call to the BigCommerce API\");\n\t\t}\n\n\t\t// If `accessToken` is null, throw an error\n\t\tif (accessToken == null) {\n\t\t\terrMessage = new Error(\"The `accessToken` is required to make any call to the BigCommerce API\");\n\t\t}\n\t}\n\n\tif (errMessage !== \"\") {\n\t\tconst exitMessage = \"Plugin terminated with errors...\";\n\n\t\tlogger.error(`${exitMessage}`);\n\n\t\tthrow errMessage;\n\t}\n};\n\n/**\n * ============================================================================\n * Create a dev server for previewing the site when `preview` is enabled\n * ============================================================================\n */\nexports.onCreateDevServer = ({ app }) =>\n\tapp.use(\n\t\t\"/__BCPreview/\",\n\t\tcreateProxyMiddleware({\n\t\t\ttarget: `http://localhost:8033`,\n\t\t\tsecure: false\n\t\t})\n\t);\n"],"mappings":"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"}